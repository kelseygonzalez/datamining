---
title: 'R exercise 3: OLAP Operations in R'
author: "Kelsey Gonzalez and Laura Werthmann"
date: "October 3, 2019"
output: html_document
---
Due October 9th
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r global_options, echo=FALSE}
knitr::opts_chunk$set(message=FALSE, warning=FALSE,fig.width=5)
```

Review of World Health Organization's Life Expectancy Data taken from [Kaggle](https://www.kaggle.com/kumarajarshi/life-expectancy-who).

First we'll load the original data:
```{r}
rm(list=ls())
suppressPackageStartupMessages(require(dplyr))
load("LifeExpectancyData.Rdata")
data$Status = as.factor(data$Status)
data = subset(data,select = -c(`Hepatitis B`))
```

Then we aquire data to include continent values and make our cuboid navigation easier. This will allow us to "roll up" to other country-key table elements.
```{r}
require(dplyr)
# from https://github.com/lukes/ISO-3166-Countries-with-Regional-Codes
library(RCurl)
ISO3166 <- read.csv(text = (getURL("https://raw.githubusercontent.com/lukes/ISO-3166-Countries-with-Regional-Codes/master/all/all.csv")))
ISO3166$name <- as.character(ISO3166$name)
# They use Eswatini instead of Swaziland, so let's update that & other naming mismatches
ISO3166$name[ISO3166$name == "Eswatini"] <- "Swaziland"
ISO3166$name[ISO3166$name == "Moldova, Republic of"] <- "Republic of Moldova"
ISO3166$name[ISO3166$name == "Korea, Republic of"] <- "Republic of Korea"
ISO3166$name[ISO3166$name == "Korea (Democratic People's Republic of)"] <- "Democratic People's Republic of Korea"
ISO3166$name[ISO3166$name == "Congo, Democratic Republic of the"] <- "Democratic Republic of the Congo"
ISO3166$name[ISO3166$name == "North Macedonia"] <- "The former Yugoslav republic of Macedonia"
ISO3166$name[ISO3166$name == "Tanzania, United Republic of"] <- "United Republic of Tanzania"

```

We created a country data frame to make the data join more easily, and then joined them by country("country", "name"), while adding the continent ("region")
```{r}
countries <- as.data.frame(unique(data$Country))
colnames(countries) <- "Country" 
countries$Country <- as.character(countries$Country)

dfcountry <- left_join(x = countries, 
                   y = ISO3166, 
                   by = c("Country" = "name"))


data <- left_join(x = data,
                   y = dfcountry[,c("Country","region")], 
                   by = c("Country" = "Country"))

save(data, file = "LifeExpectancyData_3.Rdata")
```
## Q1
>please generate 3-D cuboids

Now we create a simple 3-d cuboid with dimensions of x = country, z = year, and y = other variables / dimensions
```{r, message = 1:10}
cntrycuboid <- array(split(data, data$Year))
# glimpse(cntrycuboid) #way too long to print 
summary(cntrycuboid)
```

We then roll-up to view the continent level of the cuboid
```{r R.options=list(max.print=50)}
rollup <- data %>% group_by(Year, region) %>% summarise(meancontinent = mean(`Life expectancy`))
 continentcuboid <- array(split(rollup, rollup$Year))
 
glimpse(rollup)
```

##  Q2
>What is 4-D or the base cuboid in this example?

The 4-d cubiod of this example could stratify the previous 3-d cuboid by status (devoping v developed)
```{r R.options=list(max.print=10)}
four_d = subset(data,select = c("Year", "Status", "Country", "Life expectancy"))
four_d <- array(split(four_d, four_d[,1:2]))
dim(four_d)
glimpse(four_d)
```