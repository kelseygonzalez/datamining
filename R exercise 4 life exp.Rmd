---
title: 'R exercise 4: Association Rule Mining'
author: "Kelsey Gonzalez and Laura Werthmann"
date: "Due October 23, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r global_options, echo=FALSE}
knitr::opts_chunk$set(message=FALSE, warning=FALSE,fig.width=5)
```

# Associative Rule Mining of Boston Dataset

```{r}
library (arules)
library(dplyr)
library(arulesViz)

options(scipen = 999)
```

# [REQUIRED]
### Mine association rules from your dataset. 

# Associative Rule Mining of our Dataset, 
After going through this exercise, perform association rule learning on your dataset. Turn in both the R code for the exercise, and the R code for the practice using your datasets. You want to explore different thresholds, use the interactive vis tools provided by arulesViz, and find and report at least two interesting association rules from your dataset. 
```{r}
rm(list=ls())
load("LifeExpectancyData_3.Rdata")
data$Status = as.factor(data$Status)
data$Year = as.factor(data$Year)
data$Country = as.factor(data$Country)


data$Life <- cut(data$`Life expectancy`, 
                              breaks = 3, 
                              labels=c('low LE', 'middle LE', 'high LE'))
data$infantmort <- cut(data$`infant deaths`, 
                              breaks = 3, 
                              labels=c('low_infant', 'middle_infant', 'high_infant'))
data$expenditure <- cut(data$`Total expenditure`, 
                              breaks = 3, 
                              labels=c('low_expenditure','med_expenditure', 'high_expenditure'))
data$pop <- cut(data$Population, 
                              breaks = 3, 
                              labels=c('low_pop','med_pop', 'high_pop'))
data$bmi <- cut(data$BMI, 
                              breaks = 3, 
                              labels=c('low_BMI','med_BMI', 'high_BMI'))  
data$gdp <- cut(data$GDP, 
                              breaks = 3, 
                              labels=c('low_GDP','med_GDP', 'high_GDP'))  
data$alcohol <- cut(data$Alcohol, 
                              breaks = 3, 
                              labels=c('low_alc','med_alc', 'high_alc'))  

drops <- c("Alcohol",
           "percentage expenditure",
           "BMI",
           "GDP",
           "Diphtheria",
           "Life expectancy",
           "Measles",
           "infant deaths",
           "Total expenditure", 
           "thinness  1-19 years",  
           "thinness 5-9 years", 
           "Population", 
           "HIV/AIDS", 
           "Polio",
           "under-five deaths",
           "Adult Mortality",
           "Income composition of resources",
           "Schooling")
data <- data[ , !(names(data) %in% drops)]
```

transform the dataframe b to a transactions dataset, where each row is described by a set of **binary** variables (this is “bitmap indexing” we learned in Chapter 4 in the textbook) 
transactions data are often very large and sparse, directly looking at it won’t give your much information.You can see how the columns are constructed by using colnames(), or see a summary() of it. To see the records, use inspect(): inspect(b[1:9]) show the first 9 transactions.
```{r}
b <- as(as.data.frame(data), "transactions") 

inspect(b[1:3]) 
```

```{r}
ars <- apriori(b, parameter = list(support=0.30, confidence=0.75))
#222 rules created
```
```{r}
#find rules generated from maximal/closed itemsets: 
#maximal itemsets
inspect(head(subset(ars, subset=is.maximal(ars), 5, by="support")))
```

```{r}
inspect(head(subset(ars, subset=rhs %in% "Life=low LE"), 5, by="support"))
inspect(head(subset(ars, subset=rhs %in% "Life=middle LE"), 5, by="support"))
inspect(head(subset(ars, subset=rhs %in% "Life=high LE"), 5, by="support"))

```


```{r}
# need to find freq itemsets to find closed itemsets:
freq.itemsets <- apriori(b, parameter=list(target="frequent itemsets", support=0.25))
closed = freq.itemsets[is.closed(freq.itemsets)]
inspect(head(subset(freq.itemsets, subset=is.closed(freq.itemsets), 5, by="support")))
```


```{r}
#find maximal itemsets
maximal = freq.itemsets[is.maximal(freq.itemsets)]
summary(maximal)
```

```{r}
#check shorter rules
inspect(head(subset(ars, subset= size(lhs)<5 & size(lhs) >1), 5, by="support"))

#note the above rules have high support and confidence but low lift.
inspect(head(subset(ars, subset= size(lhs)<5 & size(lhs) >1 & lift > 1), 5, by="support"))
```
Plotting rules by confidence and support
```{r}
plot(ars, engine="interactive")
``` 

```{r}
#click the stop sign or the ESC key to terminate an interactive session. 
#Controls provided by Engine=”interactive” do not responding on my laptop, but engine="htmlwidget" does and supports a level of interactive exploration of the rule set. 
#You can filter your rules to a smaller set and then use the interactive exploration to identify interesting rules. 
plot(ars, engine="htmlwidget")
```


```{r}
#grouped 
somerules <- subset(ars, subset=size(lhs) & confidence>0.90 & support>0.3)
plot(somerules, method="grouped")
```

```{r}
plot(somerules, method="graph", engine="htmlwidget")
```


### Discuss a couple of interesting rules mined. 
Rule 1
>{Status=Developing, infantmort=low_infant, expenditure=low_expenditure} => {alcohol=low_alc}
support: 0.385
confidence: 0.811
lift: 1.35

Rule 2
>{Status=Developing, Life=middle LE, infantmort=low_infanct, gdp=low_GDP} => {pop=low_pop}
support: 0.307
confidence: 0.991
lift: 1.28

Rule 3
>{Status=Developing, infantmort=low_infanct, bmi=low_BMI} => {pop=low_pop}
support: 0.302
confidence: 0.818
lift: 1.05